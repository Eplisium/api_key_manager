<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Key Manager</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="projects-header">
                <h2 class="font-semibold">Projects</h2>
                <button class="btn btn-primary btn-sm" onclick="showProjectModal()">New Project</button>
            </div>
            <button class="btn btn-icon w-full collapsed-new-project" onclick="showProjectModal()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                <span>New Project</span>
                <div class="project-tooltip">New Project</div>
            </button>
            <button class="btn btn-icon w-full mb-4" onclick="showAllKeys()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-list"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>
                <span>Show All</span>
                <div class="project-tooltip">Show All Keys</div>
            </button>
        </div>
        <button class="theme-toggle" id="theme-toggle">
            <svg id="theme-toggle-dark-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
            <svg id="theme-toggle-light-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
            <div class="project-tooltip">Toggle Theme</div>
        </button>
        <div class="theme-separator"></div>
        <div class="projects-container">
            <div id="projects-list"></div>
        </div>
        <div class="theme-separator"></div>
        <button class="clear-all-btn" onclick="confirmClearAllKeys()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
            <span>Clear All Keys</span>
            <div class="project-tooltip">Clear All Keys</div>
        </button>
        <button id="toggle-sidebar" class="toggle-sidebar" onclick="toggleSidebar()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
        </button>
    </div>

    <div class="main-content" id="main-content">
        <header class="header">
            <h1 class="title">API <span class="key-text" onclick="toggleRainbow(event)">Key</span> Manager</h1>
            <div class="header-actions">
                <input type="file" id="env-file-input" accept=".env,.json,.yaml,.yml,.properties,.conf,.config" style="display: none" onchange="handleEnvFileUpload(event)">
                <div class="dropdown" style="margin-right: 8px;">
                    <button id="import-env-btn" class="btn btn-secondary" onclick="toggleImportDropdown()" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                        Import
                    </button>
                    <div class="dropdown-content" id="import-dropdown">
                        <a href="#" onclick="document.getElementById('env-file-input').click()">From File</a>
                        <a href="#" onclick="importFromOS()">From OS</a>
                    </div>
                </div>
                <div class="dropdown" style="margin-right: 8px;">
                    <button class="btn btn-secondary" onclick="toggleExportDropdown()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        Export
                    </button>
                    <div class="dropdown-content" id="export-dropdown">
                        <a href="#" onclick="exportKeys('env')">.env format</a>
                        <a href="#" onclick="exportKeys('json')">JSON format</a>
                        <a href="#" onclick="exportKeys('yaml')">YAML format</a>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="showAddModal()">Add New Key</button>
            </div>
        </header>

        <div id="keys-container" class="keys-grid"></div>

        <!-- Add/Edit Modal -->
        <div id="key-modal" class="modal">
            <div class="modal-content">
                <h2 class="text-xl font-semibold mb-4" id="modal-title">Add New Key</h2>
                <form id="key-form" onsubmit="handleFormSubmit(event)">
                    <input type="hidden" id="key-id">
                    <div class="input-group">
                        <label class="input-label" for="name">Name</label>
                        <input type="text" id="name" class="input-field" required>
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="key">Key</label>
                        <input type="text" id="key" class="input-field" required>
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="description">Description</label>
                        <textarea id="description" class="input-field" rows="3"></textarea>
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="used-with">Used With</label>
                        <input type="text" id="used-with" class="input-field">
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="project">Project</label>
                        <select id="project" class="input-field">
                            <option value="">No Project</option>
                        </select>
                    </div>
                    <div class="mt-4 flex gap-2">
                        <button type="submit" class="btn btn-primary">Save</button>
                        <button type="button" class="btn" onclick="hideModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Project Modal -->
        <div id="project-modal" class="modal">
            <div class="modal-content">
                <h2 class="text-xl font-semibold mb-4" id="project-modal-title">New Project</h2>
                <form id="project-form" onsubmit="handleProjectSubmit(event)">
                    <input type="hidden" id="project-id">
                    <div class="input-group">
                        <label class="input-label" for="project-name">Project Name</label>
                        <input type="text" id="project-name" class="input-field" required>
                    </div>
                    <div class="mt-4 flex gap-2">
                        <button type="submit" class="btn btn-primary">Save</button>
                        <button type="button" class="btn" onclick="hideProjectModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Post-Import Configuration Modal -->
        <div id="post-import-modal" class="modal">
            <div class="modal-content post-import-modal">
                <div class="import-header">
                    <div class="import-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                        <h2 class="text-xl font-semibold">Configure Imported Keys</h2>
                    </div>
                    <div class="import-summary">
                        <span id="import-count"></span>
                    </div>
                </div>

                <div class="bulk-actions">
                    <div class="bulk-header">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                        <span class="font-semibold">Bulk Actions</span>
                    </div>
                    <div class="bulk-content">
                        <div class="input-group with-icon">
                            <label class="input-label">Set "Description" for all keys</label>
                            <div class="input-with-button">
                                <input type="text" id="bulk-description" class="input-field" placeholder="Add a description for all keys...">
                                <button class="btn btn-secondary" onclick="applyBulkDescription()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                                    Apply
                                </button>
                                <button class="btn btn-secondary" onclick="clearAllDescriptions()" title="Clear all descriptions">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/></svg>
                                    Clear All
                                </button>
                            </div>
                        </div>
                        <div class="input-group with-icon">
                            <label class="input-label">Set "Used with" for all keys</label>
                            <div class="input-with-button">
                                <input type="text" id="bulk-used-with" class="input-field" placeholder="e.g., AWS, Google Cloud, Azure...">
                                <button class="btn btn-secondary" onclick="applyBulkUsedWith()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                                    Apply
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="imported-keys-container">
                    <div class="keys-header">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0 3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
                        <span class="font-semibold">Imported Keys</span>
                        <div class="selection-controls">
                            <button class="btn btn-secondary btn-sm" onclick="toggleAllKeys()">
                                <span id="select-all-text">Select All</span>
                            </button>
                            <button class="btn btn-secondary btn-sm destructive" onclick="removeUnselectedKeys()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/></svg>
                                Remove Unselected
                            </button>
                        </div>
                    </div>
                    <div class="imported-keys-list" id="imported-keys-list">
                        <!-- Keys will be populated here -->
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn" onclick="hidePostImportModal()">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveImportedKeysConfig()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Project Delete Confirmation Modal -->
    <div id="delete-project-modal" class="modal">
        <div class="modal-content">
            <div class="delete-project-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                <h2 class="text-xl font-semibold">Delete Project</h2>
            </div>
            <div class="delete-project-content">
                <p class="delete-project-message">What would you like to do with "<span id="project-name-display"></span>" and its associated keys?</p>
                <div class="delete-options">
                    <button class="btn btn-danger" onclick="executeProjectDelete(true)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/></svg>
                        Delete Project & Keys
                    </button>
                    <button class="btn btn-warning" onclick="executeProjectDelete(false)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 16v2a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2"/><path d="M9 11v5"/><path d="m12 13 3-3-3-3"/></svg>
                        Delete Project Only
                    </button>
                    <button class="btn" onclick="hideDeleteProjectModal()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add this right after the delete-project-modal div -->
    <div id="project-context-menu" class="context-menu">
        <button class="context-menu-item" onclick="editProjectFromMenu(event)">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
            Edit Project
        </button>
        <button class="context-menu-item destructive" onclick="deleteProjectFromMenu(event)">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
            Delete Project
        </button>
    </div>

    <!-- Add this after the project-context-menu div -->
    <div id="key-context-menu" class="context-menu">
        <div class="key-context-value"></div>
        <button class="context-menu-item" onclick="copyKeyFromMenu(event)">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
            Copy Key
        </button>
    </div>

    <!-- Color Picker Modal -->
    <div id="color-picker-modal" class="modal">
        <div class="modal-content color-picker">
            <div class="modal-header">
                <h2>Custom Title Color</h2>
                <button class="close-button" onclick="hideColorPickerModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="color-picker-container">
                    <div class="color-picker-section">
                        <label>Apply Color To</label>
                        <div class="word-selector">
                            <button class="word-select-btn active" data-word="all">Entire Title</button>
                            <button class="word-select-btn" data-word="api">API</button>
                            <button class="word-select-btn" data-word="key">Key</button>
                            <button class="word-select-btn" data-word="manager">Manager</button>
                        </div>
                    </div>
                    <div class="color-picker-section">
                        <label>Color Wheel</label>
                        <input type="color" id="color-wheel" class="color-wheel">
                    </div>
                    <div class="color-picker-section">
                        <label>HEX Color</label>
                        <div class="hex-input-container">
                            <span class="hex-prefix">#</span>
                            <input type="text" id="hex-color" class="hex-input" maxlength="6" placeholder="000000">
                        </div>
                    </div>
                    <div class="color-picker-section">
                        <label>RGB Values</label>
                        <div class="rgb-inputs">
                            <div class="rgb-input-group">
                                <label>R</label>
                                <input type="number" id="rgb-r" min="0" max="255" class="rgb-input" placeholder="0">
                            </div>
                            <div class="rgb-input-group">
                                <label>G</label>
                                <input type="number" id="rgb-g" min="0" max="255" class="rgb-input" placeholder="0">
                            </div>
                            <div class="rgb-input-group">
                                <label>B</label>
                                <input type="number" id="rgb-b" min="0" max="255" class="rgb-input" placeholder="0">
                            </div>
                        </div>
                    </div>
                    <div class="color-preview-section">
                        <label>Preview</label>
                        <div class="preview-text">
                            <span class="preview-api">API</span>
                            <span class="preview-key">Key</span>
                            <span class="preview-manager">Manager</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="modal-footer-left">
                    <button class="btn btn-icon btn-reset" onclick="resetTitleColor()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
                        Reset
                    </button>
                </div>
                <div class="modal-footer-right">
                    <button class="btn btn-secondary" onclick="hideColorPickerModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="applyCustomColor()">Apply Color</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Clear Keys Confirmation Modal -->
    <div id="clear-keys-modal" class="modal">
        <div class="modal-content">
            <div class="delete-project-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                <h2 class="text-xl font-semibold">Clear All Keys</h2>
            </div>
            <div class="delete-project-content">
                <p class="delete-project-message" id="clear-keys-message"></p>
                <div class="delete-options">
                    <button class="btn btn-danger" onclick="executeClearAllKeys()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/></svg>
                        Clear All Keys
                    </button>
                    <button class="btn" onclick="hideClearKeysModal()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Delete Key Confirmation Modal -->
    <div id="delete-key-modal" class="modal">
        <div class="modal-content">
            <div class="delete-project-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                <h2 class="text-xl font-semibold">Delete Key</h2>
            </div>
            <div class="delete-project-content">
                <p class="delete-project-message">Are you sure you want to delete this key? This action cannot be undone.</p>
                <div class="delete-options">
                    <button class="btn btn-danger" onclick="executeKeyDelete()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/></svg>
                        Delete Key
                    </button>
                    <button class="btn" onclick="hideDeleteKeyModal()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isEditMode = false;
        let selectedProject = null;
        let isProjectEditMode = false;
        let draggedKey = null;
        let draggedKeyRect = null;
        let draggedProject = null;
        let projectToDelete = null;

        // Add these new functions for context menu
        let activeProjectId = null;

        function showContextMenu(event, projectId) {
            event.preventDefault();
            event.stopPropagation();
            
            const contextMenu = document.getElementById('project-context-menu');
            const projectItem = event.currentTarget;
            const projectName = projectItem.querySelector('.project-name').textContent;
            activeProjectId = projectId;
            
            // If sidebar is collapsed, show project name in context menu
            if (document.getElementById('sidebar').classList.contains('collapsed')) {
                // Hide tooltip
                const tooltip = projectItem.querySelector('.project-tooltip');
                if (tooltip) tooltip.style.display = 'none';
                
                // Add project name to context menu if not already present
                let projectNameDisplay = contextMenu.querySelector('.project-context-name');
                if (!projectNameDisplay) {
                    projectNameDisplay = document.createElement('div');
                    projectNameDisplay.className = 'project-context-name';
                    contextMenu.insertBefore(projectNameDisplay, contextMenu.firstChild);
                }
                projectNameDisplay.textContent = projectName;
            }
            
            // Position the menu at cursor
            contextMenu.style.left = `${event.clientX}px`;
            contextMenu.style.top = `${event.clientY}px`;
            contextMenu.classList.add('show');
            
            // Add click listener to close menu when clicking outside
            document.addEventListener('click', hideContextMenu);
            document.addEventListener('contextmenu', hideContextMenu);
        }

        function hideContextMenu() {
            const contextMenu = document.getElementById('project-context-menu');
            contextMenu.classList.remove('show');
            activeProjectId = null;
            
            // Remove project name from context menu
            const projectNameDisplay = contextMenu.querySelector('.project-context-name');
            if (projectNameDisplay) {
                projectNameDisplay.remove();
            }
            
            // Show all tooltips again
            document.querySelectorAll('.project-tooltip').forEach(tooltip => {
                tooltip.style.display = '';
            });
            
            // Remove click listeners
            document.removeEventListener('click', hideContextMenu);
            document.removeEventListener('contextmenu', hideContextMenu);
        }

        function editProjectFromMenu(event) {
            event.preventDefault();
            if (activeProjectId !== null) {
                editProject(activeProjectId);
            }
            hideContextMenu();
        }

        function deleteProjectFromMenu(event) {
            event.preventDefault();
            if (activeProjectId !== null) {
                deleteProject(activeProjectId);
            }
            hideContextMenu();
        }

        // Add these new functions for key context menu
        let activeKeyValue = null;

        function showKeyContextMenu(event, keyValue) {
            event.preventDefault();
            event.stopPropagation();
            
            const contextMenu = document.getElementById('key-context-menu');
            activeKeyValue = keyValue;
            
            // Update the key value display
            const keyDisplay = contextMenu.querySelector('.key-context-value');
            keyDisplay.textContent = keyValue;
            
            // Position the menu at cursor
            contextMenu.style.left = `${event.clientX}px`;
            contextMenu.style.top = `${event.clientY}px`;
            contextMenu.classList.add('show');
            
            // Add click listener to close menu when clicking outside
            document.addEventListener('click', hideKeyContextMenu);
            document.addEventListener('contextmenu', hideKeyContextMenu);
        }

        function hideKeyContextMenu() {
            const contextMenu = document.getElementById('key-context-menu');
            contextMenu.classList.remove('show');
            activeKeyValue = null;
            
            // Remove click listeners
            document.removeEventListener('click', hideKeyContextMenu);
            document.removeEventListener('contextmenu', hideKeyContextMenu);
        }

        function copyKeyFromMenu(event) {
            event.preventDefault();
            if (activeKeyValue !== null) {
                copyToClipboard(activeKeyValue);
            }
            hideKeyContextMenu();
        }

        async function fetchProjects() {
            try {
                const response = await fetch('/projects');
                const projects = await response.json();
                renderProjects(projects);
                updateProjectSelect(projects);
            } catch (error) {
                console.error('Error fetching projects:', error);
            }
        }

        function renderProjects(projects) {
            const container = document.getElementById('projects-list');
            container.innerHTML = projects.map(project => `
                <div class="project-item ${selectedProject === project.id ? 'active' : ''}" 
                     data-project-id="${project.id}"
                     data-position="${project.position}"
                     draggable="true"
                     ondragstart="handleProjectDragStart(event, ${project.id})"
                     ondragover="handleProjectDragOver(event)"
                     ondrop="handleProjectDrop(event)"
                     ondragend="handleProjectDragEnd(event)"
                     onclick="selectProject(${project.id})"
                     oncontextmenu="showContextMenu(event, ${project.id})">
                    <div class="project-info">
                        <span class="project-name">${project.name}</span>
                        <div class="project-tooltip">${project.name}</div>
                    </div>
                    <div class="project-actions">
                        <button class="btn-icon" onclick="editProject(${project.id}, event)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                        </button>
                        <button class="btn-icon destructive" onclick="deleteProject(${project.id}, event)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateProjectSelect(projects) {
            const select = document.getElementById('project');
            select.innerHTML = '<option value="">No Project</option>' + 
                projects.map(project => `<option value="${project.id}">${project.name}</option>`).join('');
        }

        async function fetchKeys() {
            try {
                console.log('Fetching keys...');
                let url = '/keys';
                if (selectedProject !== null) {
                    url += `?project_id=${selectedProject}`;
                } else {
                    url += '?show_all=true';
                }
                const response = await fetch(url);
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to fetch keys');
                }
                const keys = await response.json();
                console.log('Received keys:', keys);
                if (!Array.isArray(keys)) {
                    console.error('Expected array of keys but got:', typeof keys, keys);
                    throw new Error('Invalid response format');
                }
                console.log('Filtered keys:', keys);
                renderKeys(keys);
            } catch (error) {
                console.error('Error fetching keys:', error);
                const container = document.getElementById('keys-container');
                container.innerHTML = 
                    '<div class="error-message">' +
                    'Failed to load keys. Please try refreshing the page.<br>' +
                    'Error: ' + error.message +
                    '</div>';
            }
        }

        function renderKeys(keys) {
            console.log('Rendering keys:', keys);
            const container = document.getElementById('keys-container');
            container.innerHTML = keys.map(key => `
                <div class="key-card" 
                     data-key-id="${key.id}" 
                     draggable="true" 
                     ondragstart="handleDragStart(event, ${key.id})"
                     ondragend="handleDragEnd(event)"
                     oncontextmenu="showKeyContextMenu(event, '${key.key.replace(/'/g, "\\'")}')">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="font-semibold">${key.name}</h3>
                            <div class="text-xs text-gray-500 mb-1">Project: ${key.project ? key.project.name : 'None'}</div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="copyToClipboard('${key.key.replace(/'/g, "\\'")}')" class="btn-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                                <span>Copy</span>
                            </button>
                            <button onclick="editKey(${key.id})" class="btn-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pencil"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                                <span>Edit</span>
                            </button>
                            <button onclick="deleteKey(${key.id})" class="btn-icon destructive">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                                <span>Delete</span>
                            </button>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 mb-2">${key.description || ''}</div>
                    <div class="text-sm text-gray-500">Used with: ${key.used_with || 'N/A'}</div>
                </div>
            `).join('');
            
            container.ondragover = handleDragOver;
            container.ondrop = handleDrop;
        }

        function showAllKeys() {
            selectedProject = null;
            localStorage.removeItem('selectedProject');
            document.querySelectorAll('.project-item').forEach(item => {
                item.classList.remove('active');
            });
            // Hide import button when showing all keys
            document.getElementById('import-env-btn').style.display = 'none';
            fetchKeys();
        }

        // Modal operations
        function showProjectModal() {
            isProjectEditMode = false;
            document.getElementById('project-form').reset();
            document.getElementById('project-modal-title').textContent = 'New Project';
            document.getElementById('project-modal').classList.add('show');
        }

        function hideProjectModal() {
            document.getElementById('project-modal').classList.remove('show');
        }

        function showAddModal() {
            isEditMode = false;
            document.getElementById('modal-title').textContent = 'Add New Key';
            document.getElementById('key-form').reset();
            document.getElementById('key-id').value = '';
            document.getElementById('key-modal').classList.add('show');
        }

        function hideModal() {
            document.getElementById('key-modal').classList.remove('show');
        }

        // Form submissions
        async function handleFormSubmit(event) {
            event.preventDefault();
            const formData = {
                name: document.getElementById('name').value,
                key: document.getElementById('key').value,
                description: document.getElementById('description').value,
                used_with: document.getElementById('used-with').value,
                project_id: document.getElementById('project').value || null
            };

            const method = isEditMode ? 'PUT' : 'POST';
            const url = isEditMode 
                ? `/keys/${document.getElementById('key-id').value}`
                : '/keys';

            try {
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to save key');
                }

                showNotification(isEditMode ? 'Key updated successfully' : 'Key added successfully', 'success');
                hideModal();
                fetchKeys();
            } catch (error) {
                console.error('Error saving key:', error);
                showNotification(error.message, 'error');
            }
        }

        async function editProject(projectId, event) {
            if (event) {
                event.stopPropagation();
            }
            try {
                const projects = await (await fetch('/projects')).json();
                const project = projects.find(p => p.id === projectId);
                if (!project) throw new Error('Project not found');

                document.getElementById('project-id').value = project.id;
                document.getElementById('project-name').value = project.name;
                
                isProjectEditMode = true;
                document.getElementById('project-modal-title').textContent = 'Edit Project';
                document.getElementById('project-modal').classList.add('show');
            } catch (error) {
                console.error('Error fetching project:', error);
                showNotification('Failed to load project details', 'error');
            }
        }

        async function handleProjectSubmit(event) {
            event.preventDefault();
            const formData = {
                name: document.getElementById('project-name').value
            };
            const projectId = document.getElementById('project-id').value;

            try {
                const url = isProjectEditMode ? `/projects/${projectId}` : '/projects';
                const method = isProjectEditMode ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to save project');
                }

                showNotification(isProjectEditMode ? 'Project updated successfully' : 'Project created successfully', 'success');
                hideProjectModal();
                fetchProjects();
            } catch (error) {
                console.error('Error saving project:', error);
                showNotification(error.message, 'error');
            }
        }

        function handleDragStart(event, keyId) {
            draggedKey = keyId;
            const keyCard = event.target;
            draggedKeyRect = keyCard.getBoundingClientRect();
            keyCard.classList.add('dragging');
            event.dataTransfer.effectAllowed = 'move';
            event.dataTransfer.setData('text/plain', keyId);
        }

        function handleDragEnd(event) {
            event.target.classList.remove('dragging');
            draggedKey = null;
            draggedKeyRect = null;
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.dataTransfer.dropEffect = 'move';
            
            // If we're dragging over a project item, just return
            if (event.currentTarget.classList.contains('project-item')) {
                event.currentTarget.classList.add('drag-over');
                return;
            }
            
            const container = document.getElementById('keys-container');
            const cards = Array.from(container.getElementsByClassName('key-card'));
            const draggedElement = document.querySelector('.dragging');
            
            if (!draggedElement) return;
            
            // Only allow reordering within the same project view
            if (selectedProject !== null) {
                const closestCard = findClosestCard(event.clientY, cards.filter(card => !card.classList.contains('dragging')));
                
                if (closestCard) {
                    const rect = closestCard.getBoundingClientRect();
                    const threshold = rect.top + rect.height / 2;
                    
                    if (event.clientY < threshold) {
                        container.insertBefore(draggedElement, closestCard);
                    } else {
                        container.insertBefore(draggedElement, closestCard.nextSibling);
                    }
                }
            }
        }

        function findClosestCard(mouseY, cards) {
            return cards.reduce((closest, card) => {
                const rect = card.getBoundingClientRect();
                const offset = mouseY - rect.top - rect.height / 2;
                
                if (closest === null || Math.abs(offset) < Math.abs(closest.offset)) {
                    return { element: card, offset: offset };
                } else {
                    return closest;
                }
            }, null)?.element;
        }

        async function handleDrop(event, projectId = null) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');
            
            const keyId = parseInt(event.dataTransfer.getData('text/plain'));
            const container = document.getElementById('keys-container');
            const cards = Array.from(container.getElementsByClassName('key-card'));
            const droppedCard = document.querySelector(`[data-key-id="${keyId}"]`);
            
            try {
                let newPosition = 0;
                
                // If dropping on a project item
                if (projectId !== null) {
                    // Move to end of target project
                    newPosition = -1;  // Special value to indicate "move to end"
                } else {
                    // Reordering within current view
                    if (!droppedCard || !selectedProject) return;
                    newPosition = cards.indexOf(droppedCard);
                    projectId = selectedProject;
                }
                
                const response = await fetch(`/keys/${keyId}/reorder`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        new_position: newPosition,
                        project_id: projectId
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to reorder key');
                }
                
                // If we moved to a different project, switch to that project view
                if (projectId !== selectedProject) {
                    selectProject(projectId);  // This will handle localStorage and UI updates
                }
                
                // Refresh the keys to ensure correct order
                await fetchKeys();
            } catch (error) {
                console.error('Error reordering key:', error);
                // Revert the UI to the original state
                await fetchKeys();
            }
        }

        async function selectProject(projectId) {
            selectedProject = projectId;
            localStorage.setItem('selectedProject', projectId);
            document.querySelectorAll('.project-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.projectId == projectId) {
                    item.classList.add('active');
                }
            });
            // Show/hide import button based on project selection
            document.getElementById('import-env-btn').style.display = projectId ? 'inline-flex' : 'none';
            fetchKeys();
        }

        document.addEventListener('dragend', () => {
            document.querySelectorAll('.project-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        });

        async function editKey(keyId, event) {
            if (event) {
                event.stopPropagation();
            }
            try {
                const response = await fetch(`/keys/${keyId}`);
                if (!response.ok) {
                    throw new Error('Failed to load key details');
                }
                const key = await response.json();
                
                document.getElementById('key-id').value = key.id;
                document.getElementById('name').value = key.name;
                document.getElementById('key').value = key.key;
                document.getElementById('description').value = key.description || '';
                document.getElementById('used-with').value = key.used_with || '';
                document.getElementById('project').value = key.project ? key.project.id : '';
                
                isEditMode = true;
                document.getElementById('modal-title').textContent = 'Edit Key';
                document.getElementById('key-modal').classList.add('show');
            } catch (error) {
                console.error('Error fetching key:', error);
                showNotification(error.message, 'error');
            }
        }

        async function deleteKey(keyId, event) {
            if (event) {
                event.stopPropagation();
            }
            showDeleteKeyModal(keyId);
        }

        function showDeleteProjectModal(projectId) {
            projectToDelete = projectId;
            const projectName = document.querySelector(`.project-item[data-project-id="${projectId}"] .project-name`).textContent;
            
            // Update the modal message with project name
            document.querySelector('.delete-project-message').textContent = 
                `What would you like to do with "${projectName}" and its associated keys?`;
            
            document.getElementById('delete-project-modal').classList.add('show');
        }

        function hideDeleteProjectModal() {
            document.getElementById('delete-project-modal').classList.remove('show');
            projectToDelete = null;
        }

        async function executeProjectDelete(deleteKeys) {
            try {
                const response = await fetch(`/projects/${projectToDelete}?delete_keys=${deleteKeys}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to delete project');
                }

                const responseData = await response.json();
                
                // Show a notification with what happened
                showNotification(`Project deleted. ${responseData.keys_affected} keys ${responseData.action}`, 'success');

                if (selectedProject === projectToDelete) {
                    showAllKeys();
                }
                fetchProjects();
                hideDeleteProjectModal();
            } catch (error) {
                console.error('Error deleting project:', error);
                showNotification(error.message, 'error');
                hideDeleteProjectModal();
            }
        }

        async function deleteProject(projectId, event) {
            if (event) {
                event.stopPropagation();
            }
            showDeleteProjectModal(projectId);
                }

        function copyToClipboard(text, event) {
            if (event) {
                event.stopPropagation();
            }
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Key copied to clipboard!', 'success');
            }).catch(err => {
                console.error('Failed to copy:', err);
                showNotification('Failed to copy to clipboard', 'error');
            });
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            const toggleButton = document.getElementById('toggle-sidebar');
            
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
            toggleButton.classList.toggle('rotated');
            
            // Save the state
            localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            
            const darkIcon = document.getElementById('theme-toggle-dark-icon');
            const lightIcon = document.getElementById('theme-toggle-light-icon');
            
            if (theme === 'dark') {
                darkIcon.classList.add('hidden');
                lightIcon.classList.remove('hidden');
            } else {
                lightIcon.classList.add('hidden');
                darkIcon.classList.remove('hidden');
            }
        }

        // Initialize theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        setTheme(savedTheme);

        // Initialize sidebar state
        const sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
        if (sidebarCollapsed) {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            const toggleButton = document.getElementById('toggle-sidebar');
            
            sidebar.classList.add('collapsed');
            mainContent.classList.add('expanded');
            toggleButton.classList.add('rotated');
        }

        document.getElementById('theme-toggle').addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            setTheme(currentTheme === 'dark' ? 'light' : 'dark');
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('Page loaded, initializing...');
            await fetchProjects();
            
            // Restore rainbow state
            const titleRainbow = localStorage.getItem('titleRainbow') === 'true';
            if (titleRainbow) {
                document.querySelector('.title').classList.add('rainbow');
            }
            
            // Restore selected project from localStorage
            const savedProject = localStorage.getItem('selectedProject');
            if (savedProject) {
                selectedProject = parseInt(savedProject);
                document.querySelectorAll('.project-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.projectId == selectedProject);
                });
                // Show import button if a project is selected
                document.getElementById('import-env-btn').style.display = 'inline-flex';
            } else {
                // Hide import button if no project is selected
                document.getElementById('import-env-btn').style.display = 'none';
            }
            
            await fetchKeys();
        });

        async function handleEnvFileUpload(event) {
            const file = event.target.files[0];
            if (!file) {
                showNotification('Please select a file', 'error');
                return;
            }

            const allowedExtensions = ['.env', '.json', '.yaml', '.yml', '.properties', '.conf', '.config'];
            const fileExt = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();
            if (!allowedExtensions.includes(fileExt)) {
                showNotification(`Invalid file type. Supported formats: ${allowedExtensions.join(', ')}`, 'error');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch(`/projects/${selectedProject}/import-env`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showPostImportModal(result.keys);
                    showNotification('File imported successfully', 'success');
                } else {
                    throw new Error(result.error || 'Failed to import file');
                }
            } catch (error) {
                console.error('Error importing file:', error);
                showNotification('Failed to import file', 'error');
            }

            // Clear the file input
            event.target.value = '';
        }

        function showPostImportModal(keys) {
            const container = document.getElementById('imported-keys-list');
            document.getElementById('import-count').textContent = `${keys.length} key${keys.length !== 1 ? 's' : ''} imported`;
            
            container.innerHTML = keys.map((key, index) => `
                <div class="imported-key-item" data-key-id="${key.id}">
                    <div class="key-select">
                        <input type="checkbox" class="key-checkbox" checked>
                    </div>
                    <div class="key-number">${index + 1}</div>
                    <div class="key-content">
                        <div class="key-header">
                            <div class="key-title">
                                <strong class="key-name">${key.name}</strong>
                                <div class="key-value" onclick="copyToClipboard('${key.key}')">
                                    <span class="text-sm text-gray-500">${key.key}</span>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                                </div>
                            </div>
                        </div>
                        <div class="key-config">
                            <div class="input-group">
                                <label class="input-label">Description</label>
                                <textarea class="input-field description-field" rows="2" placeholder="Add a description for this key...">${key.description || ''}</textarea>
                            </div>
                            <div class="input-group">
                                <label class="input-label">Used with</label>
                                <input type="text" class="input-field used-with-field" placeholder="e.g., AWS, Google Cloud..." value="${key.used_with || ''}">
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('post-import-modal').classList.add('show');
        }

        function hidePostImportModal() {
            document.getElementById('post-import-modal').classList.remove('show');
            fetchKeys(); // Refresh the keys list
        }

        function applyBulkUsedWith() {
            const bulkValue = document.getElementById('bulk-used-with').value.trim();
            if (!bulkValue) {
                showNotification('Please enter a value to apply', 'error');
                return;
            }
            
            const fields = document.querySelectorAll('.used-with-field');
            fields.forEach(field => {
                field.value = bulkValue;
                // Add a brief highlight effect to show the change
                field.style.backgroundColor = 'var(--hover)';
                setTimeout(() => {
                    field.style.backgroundColor = '';
                }, 300);
            });

            showNotification(`Applied "${bulkValue}" to ${fields.length} keys`, 'success');
        }

        function applyBulkDescription() {
            const bulkValue = document.getElementById('bulk-description').value.trim();
            if (!bulkValue) {
                showNotification('Please enter a description to apply', 'error');
                return;
            }
            
            const fields = document.querySelectorAll('.description-field');
            fields.forEach(field => {
                field.value = bulkValue;
                // Add a brief highlight effect to show the change
                field.style.backgroundColor = 'var(--hover)';
                setTimeout(() => {
                    field.style.backgroundColor = '';
                }, 300);
            });

            // Show feedback
            showNotification(`Applied description to ${fields.length} keys`, 'success');
        }

        function clearAllDescriptions() {
            const fields = document.querySelectorAll('.description-field');
            fields.forEach(field => {
                field.value = '';
                // Add a brief highlight effect to show the change
                field.style.backgroundColor = 'var(--hover)';
                setTimeout(() => {
                    field.style.backgroundColor = '';
                }, 300);
            });

            // Show feedback
            showNotification(`Cleared descriptions for ${fields.length} keys`, 'success');
        }

        let allKeysSelected = true;
        
        function toggleAllKeys() {
            allKeysSelected = !allKeysSelected;
            const checkboxes = document.querySelectorAll('.key-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = allKeysSelected;
            });
            document.getElementById('select-all-text').textContent = allKeysSelected ? 'Deselect All' : 'Select All';
        }

        async function removeUnselectedKeys() {
            const keyItems = document.querySelectorAll('.imported-key-item');
            const deletions = [];
            
            keyItems.forEach(item => {
                const checkbox = item.querySelector('.key-checkbox');
                if (!checkbox.checked) {
                    const keyId = item.dataset.keyId;
                    deletions.push(
                        fetch(`/keys/${keyId}`, { method: 'DELETE' })
                            .then(() => item.remove())
                    );
                }
            });

            try {
                await Promise.all(deletions);
                
                // Update the import count
                const remainingKeys = document.querySelectorAll('.imported-key-item').length;
                document.getElementById('import-count').textContent = 
                    `${remainingKeys} key${remainingKeys !== 1 ? 's' : ''} imported`;
                
                // Show feedback
                showNotification(`Removed ${deletions.length} key${deletions.length !== 1 ? 's' : ''}`, 'success');
            } catch (error) {
                console.error('Error removing keys:', error);
                showNotification('Some keys failed to be removed. Please try again.', 'error');
            }
        }

        async function saveImportedKeysConfig() {
            const updates = [];
            document.querySelectorAll('.imported-key-item').forEach(item => {
                const checkbox = item.querySelector('.key-checkbox');
                if (checkbox.checked) {  // Only update selected keys
                    const keyId = item.dataset.keyId;
                    const description = item.querySelector('.description-field').value;
                    const usedWith = item.querySelector('.used-with-field').value;
                    
                    updates.push(updateKey(keyId, { description, used_with: usedWith }));
                }
            });

            try {
                await Promise.all(updates);
                hidePostImportModal();
            } catch (error) {
                console.error('Error updating imported keys:', error);
                showNotification('Some keys failed to update. Please try again.', 'error');
            }
        }

        async function updateKey(keyId, data) {
            const response = await fetch(`/keys/${keyId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (!response.ok) {
                throw new Error(`Failed to update key ${keyId}`);
            }

            return response.json();
        }

        async function confirmClearAllKeys() {
            const projectName = selectedProject ? 
                document.querySelector(`.project-item[data-project-id="${selectedProject}"]`)?.querySelector('.project-name')?.textContent : 
                'all projects';
            
            const message = selectedProject ? 
                `Are you sure you want to delete ALL keys from "${projectName}"?<br><br>This action cannot be undone. There is no built-in way to recover deleted keys.<br><br>Tip: Consider exporting your keys before deletion for backup.` :
                `Are you sure you want to delete ALL keys from all projects?<br><br>This action cannot be undone. There is no built-in way to recover deleted keys.<br><br>Tip: Consider exporting your keys before deletion for backup.`;

            document.getElementById('clear-keys-message').innerHTML = message;
            document.getElementById('clear-keys-modal').classList.add('show');
        }

        function hideClearKeysModal() {
            document.getElementById('clear-keys-modal').classList.remove('show');
        }

        async function executeClearAllKeys() {
            try {
                const url = selectedProject ? `/projects/${selectedProject}/keys` : '/keys';
                const response = await fetch(url, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error('Failed to delete keys');
                }

                const result = await response.json();
                const projectName = selectedProject ? 
                    document.querySelector(`.project-item[data-project-id="${selectedProject}"]`)?.querySelector('.project-name')?.textContent : 
                    'all projects';

                showNotification(`Deleted ${result.count} keys from ${projectName}`, 'success');

                // Refresh the keys list
                fetchKeys();
            } catch (error) {
                console.error('Error clearing keys:', error);
                showNotification('Failed to clear keys. Please try again.', 'error');
            } finally {
                hideClearKeysModal();
            }
        }

        function toggleExportDropdown() {
            document.getElementById("export-dropdown").classList.toggle("show");
        }

        function toggleImportDropdown() {
            document.getElementById("import-dropdown").classList.toggle("show");
        }

        // Close dropdowns when clicking outside
        window.onclick = function(event) {
            if (!event.target.matches('.btn-secondary')) {
                var dropdowns = document.getElementsByClassName("dropdown-content");
                for (var i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }

        async function importFromOS() {
            try {
                const response = await fetch(`/projects/${selectedProject}/import-os-env`, {
                    method: 'POST'
                });

                const result = await response.json();
                if (response.ok) {
                    showPostImportModal(result.keys);
                    showNotification('Environment variables imported successfully', 'success');
                } else {
                    throw new Error(result.error || 'Failed to import OS environment variables');
                }
            } catch (error) {
                console.error('Error importing OS environment variables:', error);
                showNotification(error.message, 'error');
            }

            document.getElementById("import-dropdown").classList.remove("show");
        }

        async function exportKeys(format) {
            try {
                let url = `/export?format=${format}`;
                if (selectedProject) {
                    url += `&project_id=${selectedProject}`;
                }
                
                window.location.href = url;
                showNotification('Export started', 'success');
                
                document.getElementById("export-dropdown").classList.remove("show");
            } catch (error) {
                console.error('Error exporting keys:', error);
                showNotification('Failed to export keys. Please try again.', 'error');
            }
        }

        function handleProjectDragStart(event, projectId) {
            draggedProject = projectId;
            event.dataTransfer.setData('text/plain', projectId);
            event.currentTarget.classList.add('dragging');
        }

        function handleProjectDragOver(event) {
            event.preventDefault();
            const projectItem = event.currentTarget;
            if (projectItem.classList.contains('project-item')) {
                projectItem.classList.add('drag-over');
            }
        }

        function handleProjectDragEnd(event) {
            event.currentTarget.classList.remove('dragging');
            document.querySelectorAll('.project-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }

        async function handleProjectDrop(event) {
            event.preventDefault();
            const projectItem = event.currentTarget;
            projectItem.classList.remove('drag-over');
            
            if (!draggedProject) return;
            
            const targetProjectId = parseInt(projectItem.dataset.projectId);
            const sourceProjectId = draggedProject;
            
            if (sourceProjectId === targetProjectId) return;
            
            try {
                const targetPosition = parseInt(projectItem.dataset.position);
                
                const response = await fetch(`/projects/${sourceProjectId}/reorder`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ new_position: targetPosition })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to reorder project');
                }
                
                showNotification('Project order updated', 'success');
                await fetchProjects();
            } catch (error) {
                console.error('Error reordering project:', error);
                showNotification(error.message, 'error');
            } finally {
                draggedProject = null;
            }
        }

        // Update the title structure to support individual word coloring
        document.querySelector('.title').innerHTML = '<span class="title-api">API</span> <span class="title-key">Key</span> <span class="title-manager">Manager</span>';

        // Update click handlers for rainbow effect - only on "Key"
        document.querySelector('.title-key').addEventListener('click', (event) => {
            if (event.shiftKey) {
                const title = document.querySelector('.title');
                title.classList.toggle('rainbow');
                
                // Remove any custom colors when rainbow is active
                if (title.classList.contains('rainbow')) {
                    document.querySelectorAll('.title span').forEach(span => {
                        span.style.color = '';
                        // Clear saved colors when rainbow is enabled
                        localStorage.removeItem(`titleColor_${span.className.split('-')[1]}`);
                    });
                }
                
                // Save rainbow state
                localStorage.setItem('titleRainbow', title.classList.contains('rainbow'));
            }
        });

        // Add right-click handler for the "Key" text only
        document.querySelector('.title-key').addEventListener('contextmenu', (event) => {
            if (event.shiftKey) {
                event.preventDefault();
                showColorPickerModal(event);
            }
        });

        // Initialize title state on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Restore rainbow effect if it was active
            const wasRainbow = localStorage.getItem('titleRainbow') === 'true';
            if (wasRainbow) {
                const title = document.querySelector('.title');
                title.classList.add('rainbow');
                // Clear any saved colors
                document.querySelectorAll('.title span').forEach(span => {
                    span.style.color = '';
                    localStorage.removeItem(`titleColor_${span.className.split('-')[1]}`);
                });
            } else {
                // Restore individual word colors if rainbow was not active
                ['api', 'key', 'manager'].forEach(word => {
                    const savedColor = localStorage.getItem(`titleColor_${word}`);
                    if (savedColor) {
                        document.querySelector(`.title-${word}`).style.color = savedColor;
                    }
                });
            }
        });

        function resetTitleColor() {
            // Remove any custom colors and rainbow effect
            const title = document.querySelector('.title');
            title.classList.remove('rainbow');
            document.querySelectorAll('.title span').forEach(span => {
                span.style.color = '';
                localStorage.removeItem(`titleColor_${span.className.split('-')[1]}`);
            });
            localStorage.setItem('titleRainbow', 'false');

            // Reset color picker inputs to default color (#000000 for light mode, #FFFFFF for dark mode)
            const defaultColor = document.documentElement.getAttribute('data-theme') === 'dark' ? '#FFFFFF' : '#000000';
            document.getElementById('color-wheel').value = defaultColor;
            document.getElementById('hex-color').value = defaultColor.substring(1);
            const rgb = hexToRgb(defaultColor);
            document.getElementById('rgb-r').value = rgb.r;
            document.getElementById('rgb-g').value = rgb.g;
            document.getElementById('rgb-b').value = rgb.b;

            // Update preview
            document.querySelectorAll('.preview-text span').forEach(span => {
                span.style.color = defaultColor;
            });
        }

        let selectedWord = 'all';

        function showColorPickerModal(event) {
            if (event) {
                event.preventDefault();
            }
            const modal = document.getElementById('color-picker-modal');
            modal.classList.add('show');
            
            // Initialize with current color or default
            const currentColor = localStorage.getItem('customTitleColor') || '#000000';
            initializeColorPicker(currentColor);

            // Reset word selection to 'all'
            selectedWord = 'all';
            document.querySelectorAll('.word-select-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.word === 'all');
            });
        }

        function hideColorPickerModal() {
            document.getElementById('color-picker-modal').classList.remove('show');
        }

        function initializeColorPicker(color) {
            // Remove rainbow effect if active
            document.querySelector('.title').classList.remove('rainbow');
            localStorage.setItem('titleRainbow', 'false');

            // Set initial values
            document.getElementById('color-wheel').value = color;
            document.getElementById('hex-color').value = color.substring(1);
            
            // Convert hex to RGB
            const rgb = hexToRgb(color);
            document.getElementById('rgb-r').value = rgb.r;
            document.getElementById('rgb-g').value = rgb.g;
            document.getElementById('rgb-b').value = rgb.b;

            // Update preview
            updatePreviewColors();
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        function rgbToHex(r, g, b) {
            return '#' + [r, g, b].map(x => {
                const hex = x.toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            }).join('');
        }

        function updatePreviewColors() {
            const color = document.getElementById('color-wheel').value;
            if (selectedWord === 'all') {
                document.querySelectorAll('.preview-text span').forEach(span => {
                    span.style.color = color;
                });
            } else {
                document.querySelector(`.preview-${selectedWord}`).style.color = color;
            }
        }

        function applyCustomColor() {
            const color = document.getElementById('color-wheel').value;
            const title = document.querySelector('.title');
            
            // Remove rainbow effect
            title.classList.remove('rainbow');
            localStorage.setItem('titleRainbow', 'false');

            if (selectedWord === 'all') {
                document.querySelectorAll('.title span').forEach(span => {
                    span.style.color = color;
                    localStorage.setItem(`titleColor_${span.className.split('-')[1]}`, color);
                });
            } else {
                const targetSpan = document.querySelector(`.title-${selectedWord}`);
                targetSpan.style.color = color;
                localStorage.setItem(`titleColor_${selectedWord}`, color);
            }

            hideColorPickerModal();
        }

        // Restore custom colors on page load
        document.addEventListener('DOMContentLoaded', () => {
            ['api', 'key', 'manager'].forEach(word => {
                const savedColor = localStorage.getItem(`titleColor_${word}`);
                if (savedColor) {
                    document.querySelector(`.title-${word}`).style.color = savedColor;
                }
            });
        });

        // Add event listeners for word selection buttons
        document.querySelectorAll('.word-select-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.word-select-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedWord = btn.dataset.word;
                
                // Update preview with current colors
                updatePreviewColors();
            });
        });

        // Add event listeners for color inputs
        document.getElementById('color-wheel').addEventListener('input', (e) => {
            const color = e.target.value;
            document.getElementById('hex-color').value = color.substring(1);
            const rgb = hexToRgb(color);
            document.getElementById('rgb-r').value = rgb.r;
            document.getElementById('rgb-g').value = rgb.g;
            document.getElementById('rgb-b').value = rgb.b;
            updateColorPreview(color);
        });

        document.getElementById('hex-color').addEventListener('input', (e) => {
            let hex = e.target.value;
            if (hex.length === 6) {
                const color = '#' + hex;
                document.getElementById('color-wheel').value = color;
                const rgb = hexToRgb(color);
                document.getElementById('rgb-r').value = rgb.r;
                document.getElementById('rgb-g').value = rgb.g;
                document.getElementById('rgb-b').value = rgb.b;
                updateColorPreview(color);
            }
        });

        function handleRgbInput() {
            const r = document.getElementById('rgb-r').value;
            const g = document.getElementById('rgb-g').value;
            const b = document.getElementById('rgb-b').value;
            if (r && g && b) {
                const color = rgbToHex(Number(r), Number(g), Number(b));
                document.getElementById('color-wheel').value = color;
                document.getElementById('hex-color').value = color.substring(1);
                updateColorPreview(color);
            }
        }

        document.getElementById('rgb-r').addEventListener('input', handleRgbInput);
        document.getElementById('rgb-g').addEventListener('input', handleRgbInput);
        document.getElementById('rgb-b').addEventListener('input', handleRgbInput);

        // Add right-click handler for the title
        document.querySelector('.title').addEventListener('contextmenu', (event) => {
            if (event.shiftKey) {
                event.preventDefault();
                showColorPickerModal(event);
            }
        });

        function showTooltip(element, text) {
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            tooltip.textContent = text;
            
            // Position the tooltip
            const rect = element.getBoundingClientRect();
            tooltip.style.left = `${rect.right + 8}px`;
            tooltip.style.top = `${rect.top + rect.height / 2}px`;
            
            document.body.appendChild(tooltip);
            setTimeout(() => tooltip.classList.add('show'), 10);
            
            return tooltip;
        }

        function hideTooltip(tooltip) {
            if (tooltip) {
                tooltip.classList.remove('show');
                setTimeout(() => tooltip.remove(), 200);
            }
        }

        function showNotification(message, type = 'success') {
            // Remove any existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => notification.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            // Add appropriate icon based on type
            let icon = '';
            if (type === 'success') {
                icon = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>';
            } else if (type === 'error') {
                icon = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>';
            }
            
            notification.innerHTML = `${icon}${message}`;
            document.body.appendChild(notification);
            
            // Remove the notification after 3 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        let keyToDelete = null;

        // Update handleFormSubmit for key saving
        async function handleFormSubmit(event) {
            event.preventDefault();
            const formData = {
                name: document.getElementById('name').value,
                key: document.getElementById('key').value,
                description: document.getElementById('description').value,
                used_with: document.getElementById('used-with').value,
                project_id: document.getElementById('project').value || null
            };

            const method = isEditMode ? 'PUT' : 'POST';
            const url = isEditMode 
                ? `/keys/${document.getElementById('key-id').value}`
                : '/keys';

            try {
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to save key');
                }

                showNotification(isEditMode ? 'Key updated successfully' : 'Key added successfully', 'success');
                hideModal();
                fetchKeys();
            } catch (error) {
                console.error('Error saving key:', error);
                showNotification(error.message, 'error');
            }
        }

        // Update handleProjectSubmit for project saving
        async function handleProjectSubmit(event) {
            event.preventDefault();
            const formData = {
                name: document.getElementById('project-name').value
            };
            const projectId = document.getElementById('project-id').value;

            try {
                const url = isProjectEditMode ? `/projects/${projectId}` : '/projects';
                const method = isProjectEditMode ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to save project');
                }

                showNotification(isProjectEditMode ? 'Project updated successfully' : 'Project created successfully', 'success');
                hideProjectModal();
                fetchProjects();
            } catch (error) {
                console.error('Error saving project:', error);
                showNotification(error.message, 'error');
            }
        }

        // Update deleteKey to show confirmation modal
        function showDeleteKeyModal(keyId) {
            keyToDelete = keyId;
            document.getElementById('delete-key-modal').classList.add('show');
        }

        function hideDeleteKeyModal() {
            document.getElementById('delete-key-modal').classList.remove('show');
            keyToDelete = null;
        }

        async function executeKeyDelete() {
            try {
                const response = await fetch(`/keys/${keyToDelete}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error('Failed to delete key');
                }

                showNotification('Key deleted successfully', 'success');
                fetchKeys();
            } catch (error) {
                console.error('Error deleting key:', error);
                showNotification(error.message, 'error');
            } finally {
                hideDeleteKeyModal();
            }
        }

        // Update deleteKey function to use modal
        async function deleteKey(keyId, event) {
            if (event) {
                event.stopPropagation();
            }
            showDeleteKeyModal(keyId);
        }

        // Update error handling in editKey
        async function editKey(keyId, event) {
            if (event) {
                event.stopPropagation();
            }
            try {
                const response = await fetch(`/keys/${keyId}`);
                if (!response.ok) {
                    throw new Error('Failed to load key details');
                }
                const key = await response.json();
                
                document.getElementById('key-id').value = key.id;
                document.getElementById('name').value = key.name;
                document.getElementById('key').value = key.key;
                document.getElementById('description').value = key.description || '';
                document.getElementById('used-with').value = key.used_with || '';
                document.getElementById('project').value = key.project ? key.project.id : '';
                
                isEditMode = true;
                document.getElementById('modal-title').textContent = 'Edit Key';
                document.getElementById('key-modal').classList.add('show');
            } catch (error) {
                console.error('Error fetching key:', error);
                showNotification(error.message, 'error');
            }
        }

        // Update error handling in importFromOS
        async function importFromOS() {
            try {
                const response = await fetch(`/projects/${selectedProject}/import-os-env`, {
                    method: 'POST'
                });

                const result = await response.json();
                if (response.ok) {
                    showPostImportModal(result.keys);
                    showNotification('Environment variables imported successfully', 'success');
                } else {
                    throw new Error(result.error || 'Failed to import OS environment variables');
                }
            } catch (error) {
                console.error('Error importing OS environment variables:', error);
                showNotification(error.message, 'error');
            }

            document.getElementById("import-dropdown").classList.remove("show");
        }

        // Update error handling in exportKeys
        async function exportKeys(format) {
            try {
                let url = `/export?format=${format}`;
                if (selectedProject) {
                    url += `&project_id=${selectedProject}`;
                }
                
                window.location.href = url;
                showNotification('Export started', 'success');
                
                document.getElementById("export-dropdown").classList.remove("show");
            } catch (error) {
                console.error('Error exporting keys:', error);
                showNotification('Failed to export keys. Please try again.', 'error');
            }
        }

        // Update error handling in handleProjectDrop
        async function handleProjectDrop(event) {
            event.preventDefault();
            const projectItem = event.currentTarget;
            projectItem.classList.remove('drag-over');
            
            if (!draggedProject) return;
            
            const targetProjectId = parseInt(projectItem.dataset.projectId);
            const sourceProjectId = draggedProject;
            
            if (sourceProjectId === targetProjectId) return;
            
            try {
                const targetPosition = parseInt(projectItem.dataset.position);
                
                const response = await fetch(`/projects/${sourceProjectId}/reorder`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ new_position: targetPosition })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to reorder project');
                }
                
                showNotification('Project order updated', 'success');
                await fetchProjects();
            } catch (error) {
                console.error('Error reordering project:', error);
                showNotification(error.message, 'error');
            } finally {
                draggedProject = null;
            }
        }
    </script>

    <style>
        .delete-project-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            color: var(--danger);
        }

        .delete-project-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .delete-project-message {
            font-size: 1rem;
            color: var(--text);
            margin: 8px 0;
        }

        .delete-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .delete-options .btn {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            justify-content: center;
            padding: 12px;
            font-size: 1rem;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: var(--danger-hover);
        }

        .btn-warning {
            background-color: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background-color: var(--warning-hover);
        }
    </style>
</body>
</html>